var examine = examine || {};
examine = {
    init: function(data) {
    	var data = {"stat":{"zhoucha":5,"yecha":2,"tiancheng":10,"siwu":0,"noticeflag":13,"foundproblem":"68","two":0,"saferisk":0},"list":[{"id":"62","dateofentry":"2014-10-30","timeofentry":"23:32:49","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u5927\u8db3","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"xxxxx","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"q2","checkcontents":"adfds","checkcount":"0","improvement":"dfdf","evaluationpoints":"","pointsreasons":"","assessmentmain":"","comment":"","rectification":"","filepath":""},{"id":"63","dateofentry":"2014-10-30","timeofentry":"23:32:49","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u5927\u8db3","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"df","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"df","checkcontents":"adfds","checkcount":"0","improvement":"dfdf","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"71","dateofentry":"2014-10-03","timeofentry":"02:02:53","checkperson":"\u674e\u6d01","checkmodel":"\u663c\u67e5","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u949f\u4e16\u80fd","foundproblem":"gg","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"dd","checkcontents":"dd","checkcount":"0","improvement":"d","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"72","dateofentry":"2014-10-03","timeofentry":"02:10:33","checkperson":"\u674e\u6d01","checkmodel":"\u663c\u67e5","ischeck45":"","company":"\u5927\u8db3","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"\u53d1\u73b0\u95ee\u9898","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"E6","checkcontents":"NEIRONG","checkcount":"0","improvement":"\u610f\u89c1","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"74","dateofentry":"2014-10-03","timeofentry":"02:18:00","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u957f\u6cb3\u78a5","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"SSDSD","foundproblemcount":"4","noticeflag":"\u5426","categorynumber":"sww","checkcontents":"ss","checkcount":"0","improvement":"ss","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"75","dateofentry":"2014-10-03","timeofentry":"02:22:01","checkperson":"\u674e\u6d01","checkmodel":"\u591c\u67e5","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"hhh","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"hh","checkcontents":"mn","checkcount":"0","improvement":"kjj","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"79","dateofentry":"2014-10-17","timeofentry":"10:08:00","checkperson":"\u674e\u6d01","checkmodel":"\u591c\u67e5","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u5f20\u5efa\u8f89","foundproblem":"\u53d1\u73b0\u95ee\u9898","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"F5","checkcontents":"\u68c0\u67e5\u5185\u5bb9","checkcount":"0","improvement":"\u6539\u8fdb\u610f\u89c1","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"81","dateofentry":"2014-10-03","timeofentry":"10:17:45","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u6587\u6842\u660e","foundproblem":"\u5bf9\u5bf9","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"D","checkcontents":"D","checkcount":"0","improvement":"D","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"82","dateofentry":"2014-10-03","timeofentry":"10:27:55","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u6587\u6842\u660e","foundproblem":"s","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"sdsd","checkcontents":"s","checkcount":"0","improvement":"s","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"84","dateofentry":"2014-10-08","timeofentry":"10:29:00","checkperson":"\u674e\u6d01","checkmodel":"\u663c\u67e5","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u5f20\u5efa\u8f89","foundproblem":"s","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"ss","checkcontents":"sss","checkcount":"0","improvement":"ss","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"92","dateofentry":"2014-10-16","timeofentry":"11:00:00","checkperson":"\u674e\u6d01","checkmodel":"\u663c\u67e5","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"s","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"sdsd","checkcontents":"s","checkcount":"0","improvement":"s","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"93","dateofentry":"2014-10-08","timeofentry":"11:06:30","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u957f\u6cb3\u78a5","cadresonduty":"\u82cf\u56fd\u52c7","foundproblem":"ss","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"sss","checkcontents":"s","checkcount":"0","improvement":"s","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"109","dateofentry":"2014-10-03","timeofentry":"23:50:41","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u5f20\u5efa\u8f89","foundproblem":"\u6d4b\u8bd5","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"F4","checkcontents":"\u68c0\u67e5\u5185\u540c","checkcount":"0","improvement":"\u6539\u8fdb\u610f\u89c1","evaluationpoints":"1","pointsreasons":"1","assessmentmain":"1","comment":"1","rectification":"\u6574\u6539\u7684\u4e0d\u9519","filepath":""},{"id":"112","dateofentry":"2014-10-04","timeofentry":"22:30:24","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u949f\u4e16\u80fd","foundproblem":"ff","foundproblemcount":"4","noticeflag":"\u5426","categorynumber":"pp","checkcontents":"y7","checkcount":"0","improvement":"jjj","evaluationpoints":"1","pointsreasons":"2","assessmentmain":"2","comment":"2","rectification":"2","filepath":""},{"id":"113","dateofentry":"2014-10-04","timeofentry":"22:31:00","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u5f20\u5efa\u8f89","foundproblem":"dd","foundproblemcount":"4","noticeflag":"\u5426","categorynumber":"dd","checkcontents":"ddd","checkcount":"0","improvement":"ddd","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"114","dateofentry":"2014-10-04","timeofentry":"22:33:55","checkperson":"\u674e\u6d01","checkmodel":"\u6dfb\u4e58","ischeck45":"","company":"\u8363\u660c","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"e","foundproblemcount":"4","noticeflag":"\u5426","categorynumber":"e","checkcontents":"e","checkcount":"0","improvement":"e","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""},{"id":"115","dateofentry":"2014-10-04","timeofentry":"22:37:58","checkperson":"\u674e\u6d01","checkmodel":"\u663c\u67e5","ischeck45":"","company":"\u5927\u8db3","cadresonduty":"\u4ee3\u9ad8\u52c7","foundproblem":"dd","foundproblemcount":"4","noticeflag":"\u662f","categorynumber":"hh","checkcontents":"dd","checkcount":"0","improvement":"dd","evaluationpoints":null,"pointsreasons":null,"assessmentmain":null,"comment":null,"rectification":null,"filepath":""}],"userinfo":{"id":"1","name":"\u674e\u6d01","password":"21232f297a57a5a743894a0e4a801fc3","departmenttype":"0","department":"","position":"","mobile":null,"tel":null,"photo":null,"positionType":null,"parentDanwei":null,"parentLeader":null,"xiesi":null,"zhoucha":"5","yecha":"6","tiancheng":"4","jiancha":"7","tongzhi":"4","faxianwenti":"3","liangwei":"5","anquan":"7","email":null},"time":{"year":"2014","month":"11","day":"09"}};
    	var me = this;
        $('#search-btn').on('click', function() {
            var year = $('#year-select').val();
            var month = $('#month-select').val();
            var person = $('#person-select').val();

            if(year == '' || month == '' || person == '') {
            	alert('筛选条件选择不完整');
            	return;
            }
            var url = '/web/index.php?r=cadreexamine/selectresult&';
            url += 'year=' + year;
            url += '&month=' + month;
            url += '&person=' + encodeURIComponent(person);

	        $.post(
	        	url,
	        	{},
	        	function(data){
	        		me.renderTable(data);
	        	},
	        	'json'
	        );
        });

        $('#export-excel').on('click', function() {
            var year = $('#year-select').val();
            var month = $('#month-select').val();
            var person = $('#person-select').val();

            var koufen = $('#examine-result .koufen').val();
            var koufenyuanyin = $('#examine-result .koufenyuanyin').val();
            var kaohezhutipingyu = $('#examine-result .kaohezhutipingyu').val();

            var url = '/web/index.php?r=cadreexamine/selectresult';
            url += '&export=excel';
            url += '&year=' + year;
            url += '&month=' + month;
            url += '&person=' + encodeURIComponent(person);
            url += '&koufen=' + koufen;
            url += '&koufenyuanyin=' + encodeURIComponent(koufenyuanyin);
            url += '&kaohezhutipingyu=' + encodeURIComponent(kaohezhutipingyu);

	        $.post(
	        	url,
	        	{},
	        	function(data){
	        		alert('已发送Excel至邮箱');
	        	},
	        	'json'
	        );
        });
        //this.renderTable(data);
    },

    renderTable: function(data) {
    	var tableArea = $('#examine-result-tpl').clone();
    	var date = new Date();

    	$('.result-wrap').empty();

    	var name = data.userinfo.name;

    	var goal_zhoucha = data.userinfo.zhoucha;
    	$('i.goal-zhoucha', tableArea).html(goal_zhoucha);

    	var goal_yecha = data.userinfo.yecha;
    	$('i.goal-yecha', tableArea).html(goal_yecha);

    	var goal_tiancheng = data.userinfo.tiancheng;
    	$('i.goal-tiancheng', tableArea).html(goal_tiancheng);

    	var goal_jiancha = data.userinfo.jiancha;
    	$('i.goal-jiancha', tableArea).html(goal_jiancha);

    	var goal_tongzhi = data.userinfo.tongzhi;
    	$('i.goal-tongzhi', tableArea).html(goal_tongzhi);

    	var goal_faxianwenti = data.userinfo.faxianwenti;
    	$('i.goal-faxianwenti', tableArea).html(goal_faxianwenti);

    	var goal_liangwei = data.userinfo.liangwei;
    	$('i.goal-liangwei', tableArea).html(goal_liangwei);

    	var goal_anquan = data.userinfo.anquan;
    	$('i.goal-anquan', tableArea).html(goal_anquan);

    	var real_zhoucha = data.stat.zhoucha;
    	$('i.real-zhoucha', tableArea).html(real_zhoucha);

    	var real_yecha = data.stat.yecha;
    	$('i.real-yecha', tableArea).html(real_yecha);

    	var real_tiancheng = data.stat.tiancheng;
    	$('i.real-tiancheng', tableArea).html(real_tiancheng);

    	var real_jiancha = data.stat.siwu;
    	$('i.real-jiancha', tableArea).html(real_jiancha);

    	var real_tongzhi = data.stat.noticeflag;
    	$('i.real-tongzhi', tableArea).html(real_tongzhi);

    	var real_faxianwenti = data.stat.foundproblem;
    	$('i.real-faxianwenti', tableArea).html(real_faxianwenti);

    	var real_liangwei = data.stat.two;
    	$('i.real-liangwei', tableArea).html(real_liangwei);

    	var real_anquan = data.stat.saferisk;
    	$('i.real-anquan', tableArea).html(real_anquan);
	    
    	var time1 = data.time.now;
    	$('i.time1', tableArea).html(time1);

	    $('.list-title > td:first', tableArea).attr('rowspan', data.list.length + 1);
	    var tr_html = [];
    	for(var i = 0, len = data.list.length; i < len; i++) {
    		var item = data.list[i];
    		tr_html.push('<tr height="77">');
    		tr_html.push('<td>' + item.dateofentry + '</td>');
    		tr_html.push('<td>' + item.timeofentry + '</td>');
    		tr_html.push('<td>' + item.checkperson + '</td>');
    		tr_html.push('<td>' + item.company + '</td>');
    		tr_html.push('<td>' + item.cadresonduty + '</td>');    		
    		tr_html.push('<td>' + item.checkmodel + '</td>');
    		tr_html.push('<td>' + item.foundproblem + '</td>');
    		tr_html.push('<td>' + item.improvement + '</td>');
    		tr_html.push('<td>' + item.noticeflag + '</td>');
    		tr_html.push('<td>' + item.categorynumber + '</td>');
    		tr_html.push('</tr>');
    	}
		tr_ele = $(tr_html.join());

		$('tr.list-title', tableArea).after(tr_ele);

		tableArea.show().attr('id', 'examine-result');
		$('.result-wrap').append($('<h3 style = "font-size:16px;font-weight:bold;">被考核员工：'+name+'</h3>'))
		$('.result-wrap').append(tableArea);
    }
}
module.exports = examine;